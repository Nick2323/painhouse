#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

echo "================================================"
echo "  –û–ù–û–í–õ–ï–ù–ù–Ø –ë–ê–ó–ò –î–ê–ù–ò–• - –ê–Ω—Å–∞–º–±–ª—å '–í–æ–ª—è'"
echo "================================================"
echo ""

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –ø—Ä–∞—Ü—é—î Docker
if ! command -v docker &> /dev/null; then
    echo "‚ùå Docker –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥."
    echo ""
    echo "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤—Ä—É—á–Ω—É —á–µ—Ä–µ–∑ phpMyAdmin –∞–±–æ MySQL –∫–ª—ñ—î–Ω—Ç:"
    echo "mysql -u root -p kogut < apply_updates.sql"
    exit 1
fi

# –í–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å
echo "üìù –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
echo ""

# –°–ø—Ä–æ–±–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ —á–µ—Ä–µ–∑ Docker
if docker exec painhouse_db mysql -uroot -ppassword kogut < apply_updates.sql 2>/dev/null; then
    echo "‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ!"
    echo ""
    echo "üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤..."
    docker exec painhouse_db mysql -uroot -ppassword kogut -e "SELECT COUNT(*) AS '–§–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π' FROM media WHERE Extra=0; SELECT COUNT(*) AS '–£—á–∞—Å–Ω–∏–∫—ñ–≤' FROM members;" 2>/dev/null
else
    echo "‚ö†Ô∏è  –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ —á–µ—Ä–µ–∑ Docker."
    echo ""
    echo "–í–∏–∫–æ–Ω–∞–π—Ç–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Ä—É—á–Ω—É –æ–¥–Ω–∏–º –∑ –º–µ—Ç–æ–¥—ñ–≤:"
    echo ""
    echo "1. –ß–µ—Ä–µ–∑ phpMyAdmin (http://localhost:8080):"
    echo "   - –í—ñ–¥–∫—Ä–∏–π—Ç–µ phpMyAdmin"
    echo "   - –í–∏–±–µ—Ä—ñ—Ç—å –±–∞–∑—É 'kogut'"
    echo "   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ SQL –≤–∫–ª–∞–¥–∫—É"
    echo "   - –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É apply_updates.sql"
    echo "   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–í–∏–∫–æ–Ω–∞—Ç–∏'"
    echo ""
    echo "2. –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫ Docker:"
    echo "   docker exec -i painhouse_db mysql -uroot -ppassword kogut < apply_updates.sql"
    echo ""
fi

echo ""
echo "================================================"
echo "  –ù–û–í–Ü –î–ê–ù–Ü –î–õ–Ø –í–•–û–î–£ –í –ê–î–ú–Ü–ù-–ü–ê–ù–ï–õ–¨"
echo "================================================"
echo "üîê –õ–æ–≥—ñ–Ω: admin"
echo "üîê –ü–∞—Ä–æ–ª—å: Admin2025!"
echo ""
echo "üìç URL –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ: http://localhost/site/admin"
echo "================================================"
