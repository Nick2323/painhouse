# üîß –Ü–ù–°–¢–†–£–ö–¶–Ü–Ø: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ñ—É–Ω–∫—Ü—ñ–π –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ

## ‚ö†Ô∏è –©–û –í–ò–ü–†–ê–í–õ–ï–ù–û

–Ø –≤–∏–ø—Ä–∞–≤–∏–≤ **–∫—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ JavaScript** –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ —Ç–∞ —Å—Ç–≤–æ—Ä–∏–≤ –æ–Ω–æ–≤–ª–µ–Ω—ñ –≤–µ—Ä—Å—ñ—ó –≤—Å—ñ—Ö –º–µ—Ç–æ–¥—ñ–≤ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **session authentication**.

### ‚úÖ –©–æ –≤–∂–µ –ø—Ä–∞—Ü—é—î (–∑–∞–∫–æ–º—ñ—á–µ–Ω–æ):
1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ "login is not defined"
2. ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
3. ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫—ñ–≤
4. ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä—É
5. ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞
6. ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞

### ‚ö†Ô∏è –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ –≤—Ä—É—á–Ω—É:
7. ‚ùå –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä—É (–ø—ñ—Å–µ–Ω—å)
8. ‚ùå –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞
9. ‚ùå –ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—é
10. ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è (—É—á–∞—Å–Ω–∏–∫—ñ–≤, —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä—É, –º–µ–¥—ñ–∞)

---

## üìã –ú–ï–¢–û–î 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–Ø —Å—Ç–≤–æ—Ä–∏–≤ —Ñ–∞–π–ª–∏ –∑ –≥–æ—Ç–æ–≤–∏–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏:

### –§–∞–π–ª–∏ –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:
1. `UPDATED_ADMIN_METHODS.php` - –æ–Ω–æ–≤–ª–µ–Ω—ñ PHP –º–µ—Ç–æ–¥–∏
2. `UPDATED_ADMIN_JS_FUNCTIONS.js` - –æ–Ω–æ–≤–ª–µ–Ω—ñ JavaScript —Ñ—É–Ω–∫—Ü—ñ—ó
3. `FIX_ADMIN_PANEL_INSTRUCTIONS.md` - —Ü—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### –ö—Ä–æ–∫–∏:

#### 1. –û–Ω–æ–≤–∏—Ç–∏ AdminController.php

–í—ñ–¥–∫—Ä–∏–π—Ç–µ `/protected/controllers/AdminController.php` —Ç–∞ –∑–∞–º—ñ–Ω—ñ—Ç—å —Ü—ñ –º–µ—Ç–æ–¥–∏:

**–ó–∞–º—ñ–Ω–∏—Ç–∏:**
- `actionAddrepertoire()` - –∑ —Ä—è–¥–∫–∞ ~232
- `actionChangepass()` - –∑ —Ä—è–¥–∫–∞ ~289
- `actionUploadmedia()` - –∑ —Ä—è–¥–∫–∞ ~141
- `actionDelmember()` - —è–∫—â–æ —î
- `actionDelrepertoire()` - —è–∫—â–æ —î
- `actionDelmedia()` - —è–∫—â–æ —î

**–ù–∞:**
–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –º–µ—Ç–æ–¥–∏ –∑ —Ñ–∞–π–ª—É `UPDATED_ADMIN_METHODS.php`

#### 2. –û–Ω–æ–≤–∏—Ç–∏ admin.js

–í—ñ–¥–∫—Ä–∏–π—Ç–µ `/js/admin.js` —Ç–∞ –∑–∞–º—ñ–Ω—ñ—Ç—å —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó:

**–ó–∞–º—ñ–Ω–∏—Ç–∏:**
- `addRepertoire(event)` - –∑ —Ä—è–¥–∫–∞ ~279
- `uploadMedia(event)` - —è–∫—â–æ —î
- `changePassword(event)` - —è–∫—â–æ —î
- `deleteMember(id, name)` - —è–∫—â–æ —î
- `deleteRepertoire(name)` - —è–∫—â–æ —î
- `deleteMedia(id, fileName)` - —è–∫—â–æ —î

**–ù–∞:**
–°–∫–æ–ø—ñ—é–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ —Ñ–∞–π–ª—É `UPDATED_ADMIN_JS_FUNCTIONS.js`

---

## üìã –ú–ï–¢–û–î 2: –†—É—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ —á–µ—Ä–∑—ñ

–Ø–∫—â–æ –Ω–µ —Ö–æ—á–µ—Ç–µ –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤–µ—Å—å –∫–æ–¥, –æ—Å—å –∫–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏:

### –ó–º—ñ–Ω–∏ –≤ AdminController.php:

**–ë–£–õ–û:**
```php
public function actionAddrepertoire(){
    $data=$_POST['command'];
    $Login=$data['login'];
    $Password=$data['password'];
    if($this->check_password($Login,$Password)){
        // –∫–æ–¥...
    }
}
```

**–°–¢–ê–õ–û:**
```php
public function actionAddrepertoire(){
    // Check session
    if(!$this->isAdminLoggedIn()){
        echo json_encode(array('text' => '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ'));
        return;
    }

    // –û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞–ø—Ä—è–º—É –∑ $_POST
    $name = $_POST['Name'];
    $category = $_POST['Category'];
    // –∫–æ–¥...
}
```

### –ó–º—ñ–Ω–∏ –≤ admin.js:

**–ë–£–õ–û:**
```javascript
function addRepertoire(event) {
    const data = {
        Name: name,
        Category: category,
        login: login,    // ‚ùå –í–ò–î–ê–õ–ò–¢–ò
        password: password // ‚ùå –í–ò–î–ê–õ–ò–¢–ò
    };

    $.ajax({
        data: { command: data }, // ‚ùå –ó–ú–Ü–ù–ò–¢–ò
    });
}
```

**–°–¢–ê–õ–û:**
```javascript
function addRepertoire(event) {
    $.ajax({
        data: {
            Name: name,
            Category: category
        }, // ‚úÖ –ë–ï–ó command array
    });
}
```

---

## üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø

### –ü—ñ—Å–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å:

1. **Hard Reload**: `Ctrl+Shift+R` (Windows/Linux) –∞–±–æ `Cmd+Shift+R` (Mac)
2. **–£–≤—ñ–π—Ç–∏ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å**:
   - URL: `http://localhost/site/admin`
   - –õ–æ–≥—ñ–Ω: `admin`
   - –ü–∞—Ä–æ–ª—å: `Admin2025!`

3. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω—Å–æ–ª—å** (`F12` ‚Üí Console):
   - ‚ùå –ù–µ –º–∞—î –±—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ "login is not defined"
   - ‚ùå –ù–µ –º–∞—î –±—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ "Unauthorized"
   - ‚úÖ –ú–∞—î –±—É—Ç–∏ "Server response: ..." –∑ –¥–∞–Ω–∏–º–∏

4. **–ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é**:

#### ‚úÖ –î–æ–¥–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫–∞:
- –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–£—á–∞—Å–Ω–∏–∫–∏" ‚Üí "–î–æ–¥–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫–∞"
- –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ–æ—Ä–º—É
- –û–±—Ä–∞—Ç–∏ —Ñ–æ—Ç–æ (JPG/PNG)
- –ó–±–µ—Ä–µ–≥—Ç–∏
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: "–£—á–∞—Å–Ω–∏–∫–∞ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!"

#### ‚úÖ –î–æ–¥–∞—Ç–∏ –ø—ñ—Å–Ω—é:
- –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–†–µ–ø–µ—Ä—Ç—É–∞—Ä" ‚Üí "–î–æ–¥–∞—Ç–∏ —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä"
- –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤—É –ø—ñ—Å–Ω—ñ
- –í–∏–±—Ä–∞—Ç–∏ –∞–±–æ –≤–≤–µ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
- –ó–±–µ—Ä–µ–≥—Ç–∏
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: "–†–µ–ø–µ—Ä—Ç—É–∞—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ."

#### ‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–¥—ñ–∞:
- –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ú–µ–¥—ñ–∞" ‚Üí "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–¥—ñ–∞"
- –û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª (JPG/PNG/MP3/MP4)
- –î–æ–¥–∞—Ç–∏ –æ–ø–∏—Å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: "–§–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!"

#### ‚úÖ –ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å:
- –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"
- –í–≤–µ—Å—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –ø–∞—Ä–æ–ª—å: `Admin2025!`
- –í–≤–µ—Å—Ç–∏ –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å (–º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤)
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å
- –ó–±–µ—Ä–µ–≥—Ç–∏
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: "–ü–∞—Ä–æ–ª—å —É—Å–ø—ñ—à–Ω–æ –∑–º—ñ–Ω–µ–Ω–æ!"

#### ‚úÖ –í–∏–¥–∞–ª–∏—Ç–∏:
- –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ –∫–Ω–æ–ø–∫—É "–í–∏–¥–∞–ª–∏—Ç–∏" –±—ñ–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
- –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: "—É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ"

---

## üêõ –í–ò–†–Ü–®–ï–ù–ù–Ø –ü–†–û–ë–õ–ï–ú

### –ü—Ä–æ–±–ª–µ–º–∞: "login is not defined" –≤—Å–µ —â–µ —î

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤ `mainpanel.php` —î —Ä—è–¥–∫–∏ 297-302:
```javascript
var baseUrl = '<?php echo Yii::app()->baseUrl; ?>';
var login = '<?php echo Yii::app()->session->get('admin_login', ''); ?>';
var password = '';
```
2. Hard Reload: `Ctrl+Shift+R`

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ" –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –¥—ñ—ó

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤–∏ —É–≤—ñ–π—à–ª–∏ —á–µ—Ä–µ–∑ `/site/admin`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤ `AdminController.php` —î –º–µ—Ç–æ–¥–∏:
   - `isAdminLoggedIn()`
   - `setAdminSession($login)`
   - `clearAdminSession()`
3. –í–∏–π–¥—ñ—Ç—å —Ç–∞ —É–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∏ –≤—Å–µ —â–µ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å

**–†—ñ—à–µ–Ω–Ω—è:**
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (`F12` ‚Üí Console)
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î –ø–æ–º–∏–ª–∫–∏ JavaScript
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–∏
4. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –Ω–µ–º–∞—î —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ PHP

### –ü—Ä–æ–±–ª–µ–º–∞: "ERR_CONNECTION_RESET"

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞—Ü—é—î Docker:
   ```bash
   docker ps | grep painhouse
   ```
2. –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker logs painhouse_web --tail 50
   ```
3. –ú–æ–∂–ª–∏–≤–∞ PHP –ø–æ–º–∏–ª–∫–∞ - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–Ü–°–õ–Ø –û–ù–û–í–õ–ï–ù–ù–Ø

- [ ] –§–∞–π–ª `AdminController.php` –æ–Ω–æ–≤–ª–µ–Ω–æ
- [ ] –§–∞–π–ª `admin.js` –æ–Ω–æ–≤–ª–µ–Ω–æ
- [ ] Hard Reload –≤–∏–∫–æ–Ω–∞–Ω–æ
- [ ] –í—Ö—ñ–¥ –≤ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ø—Ä–∞—Ü—é—î
- [ ] –ö–æ–Ω—Å–æ–ª—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ "login is not defined"
- [ ] –î–æ–¥–∞–≤–∞–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞ –ø—Ä–∞—Ü—é—î
- [ ] –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–ø–µ—Ä—Ç—É–∞—Ä—É –ø—Ä–∞—Ü—é—î
- [ ] –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞ –ø—Ä–∞—Ü—é—î
- [ ] –ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—é –ø—Ä–∞—Ü—é—î
- [ ] –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—î
- [ ] –í—Å—ñ –¥–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Ç–∞–±–ª–∏—Ü—ñ)

---

## üìù –†–ï–ó–Æ–ú–ï –ó–ú–Ü–ù

### –î–æ:
- ‚ùå –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –≤–∏–º–∞–≥–∞–≤ login/password
- ‚ùå –ù–µ–±–µ–∑–ø–µ—á–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–æ–ª—ñ–≤
- ‚ùå –ü–æ–º–∏–ª–∫–∏ "login is not defined"
- ‚ùå –ù—ñ—á–æ–≥–æ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–æ

### –ü—ñ—Å–ª—è:
- ‚úÖ Session authentication
- ‚úÖ –ü–∞—Ä–æ–ª—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥—ñ
- ‚úÖ –í—Å—ñ –∑–º—ñ–Ω–Ω—ñ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ
- ‚úÖ –í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å

---

## üÜò –Ø–ö–©–û –ù–Ü–ß–û–ì–û –ù–ï –î–û–ü–û–ú–ê–ì–ê–Ñ

–ù–∞–ø–∏—à—ñ—Ç—å –º–µ–Ω—ñ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é:
1. –°–∫—Ä—ñ–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)
2. –°–∫—Ä—ñ–Ω—à–æ—Ç Network tab (F12 ‚Üí Network) –ø—ñ–¥ —á–∞—Å –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏
3. –¢–µ–∫—Å—Ç –ø–æ–º–∏–ª–∫–∏ –∑ –ª–æ–≥—ñ–≤ Docker (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω—ñ)

–î–æ–ø–æ–º–æ–∂—É –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É!
